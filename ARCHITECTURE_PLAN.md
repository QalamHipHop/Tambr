# طرح معماری و نقشه راه پیاده‌سازی نهایی (Tambr - RialToken)

این سند، طرح معماری فنی و نقشه راه تفصیلی برای پیاده‌سازی پروژه "ریال‌توکن" (Tambr) بر اساس "طرح استراتژیک نهایی و بهینه‌سازی‌شده" است. هدف، ایجاد یک اکوسیستم کاملاً منطبق با قوانین داخلی، مقیاس‌پذیر و با تجربه کاربری (UX) در سطح جهانی است.

## ۱. ساختار Monorepo (Monorepo Structure)

پروژه با استفاده از یک Monorepo مبتنی بر **pnpm Workspaces** و **TypeScript** مدیریت خواهد شد تا از اشتراک‌گذاری کد و Type Safety در سراسر پشته (Full-Stack) اطمینان حاصل شود.

| مسیر | محتوا | تکنولوژی | توضیحات |
| :--- | :--- | :--- | :--- |
| `packages/contracts` | قراردادهای هوشمند | **Solidity** (EVM), **Hardhat** | شامل قراردادهای DBC، IRR-Stablecoin، Gasless Relayer، Smart Tickets، SBTs و Governance. |
| `packages/backend` | سرویس‌های بک‌اند | **NestJS** (TypeScript, Node.js) | API Gateway، مدیریت KYC/AML، سرویس‌های اوراکل، مدیریت کاربران و کیف پول (SRW). |
| `packages/frontend` | رابط کاربری اصلی | **Next.js** (React, TypeScript) | رابط کاربری وب، داشبورد کاربران، رابط DBC، مدیریت SRW و تراکنش‌های Gasless. |
| `packages/shared` | کتابخانه‌های مشترک | **TypeScript** | شامل تعاریف Type، توابع کمکی (Utility Functions)، و منطق مشترک برای ارتباط با قراردادها. |
| `packages/relayer` | شبکه رله تراکنش | **NestJS/Express** | سرویس اختصاصی برای دریافت تراکنش‌های امضاشده توسط کاربران و ارسال آن‌ها به Sidechain با پرداخت Gas Fee. |

## ۲. نقشه راه پیاده‌سازی تفصیلی (Detailed Implementation Roadmap)

نقشه راه بر اساس فازهای استراتژیک تعریف‌شده در سند اصلی، با تمرکز بر پیاده‌سازی فنی، تنظیم شده است.

### فاز ۱: زیرساخت و هسته قراردادها (Core Infrastructure & Contracts)

| وظیفه | جزئیات فنی | خروجی |
| :--- | :--- | :--- |
| **۱.۱. راه‌اندازی Monorepo** | ایجاد ساختار دایرکتوری، پیکربندی `pnpm-workspace.yaml`، نصب وابستگی‌های اصلی (Next.js, NestJS, Hardhat). | ساختار Monorepo آماده توسعه. |
| **۱.۲. قرارداد IRR-Stablecoin** | پیاده‌سازی قرارداد ERC-20 ساده با قابلیت Pause/Unpause و Mint/Burn توسط نهاد صادرکننده (برای شبیه‌سازی پشتوانه ریالی). | `IRRStablecoin.sol` |
| **۱.۳. قرارداد Dynamic Bonding Curve (DBC)** | پیاده‌سازی منطق DBC با توابع `buy()` و `sell()` و اتصال به یک **Mock Oracle** برای قیمت‌گذاری اولیه. | `DynamicBondingCurve.sol` |
| **۱.۴. راه‌اندازی Sidechain (Mock)** | پیکربندی یک شبکه محلی (Local Hardhat Network) برای شبیه‌سازی Sidechain EVM-Compatible. | محیط توسعه بلاکچین محلی. |

### فاز ۲: بک‌اند و احراز هویت (Backend & Compliance)

| وظیفه | جزئیات فنی | خروجی |
| :--- | :--- | :--- |
| **۲.۱. سرویس KYC/AML** | ایجاد ماژول NestJS برای مدیریت احراز هویت سطح ۱ (شماره موبایل و کد ملی) و شبیه‌سازی اتصال به سامانه‌های ملی. | APIهای `POST /kyc/level1` |
| **۲.۲. سرویس مدیریت کیف پول (SRW)** | پیاده‌سازی منطق بک‌اند برای مدیریت کلیدهای Social Recovery و اتصال به قراردادهای ERC-4337 (Account Abstraction). | ماژول `WalletService` |
| **۲.۳. سرویس Gasless Relayer** | پیاده‌سازی سرویس رله برای دریافت تراکنش‌های امضاشده (Meta-Transactions) و ارسال آن‌ها به Sidechain با پرداخت Gas Fee توسط پلتفرم. | سرویس `Relayer` فعال. |
| **۲.۴. سرویس Oracle** | پیاده‌سازی سرویس اوراکل برای تأمین قیمت ریال و پارامترهای DBC به قراردادهای هوشمند. | APIهای `GET /oracle/price` |

### فاز ۳: رابط کاربری و تجربه کاربری (Frontend & UX)

| وظیفه | جزئیات فنی | خروجی |
| :--- | :--- | :--- |
| **۳.۱. رابط کاربری DBC** | ایجاد صفحات Next.js برای خرید و فروش توکن از طریق DBC با نمایش نمودار قیمت و موجودی کاربر. | صفحه `Buy/Sell` |
| **۳.۲. رابط کاربری Social Recovery** | پیاده‌سازی فرآیند ثبت‌نام و بازیابی کیف پول با استفاده از مخاطبین مورد اعتماد (Guardians). | ماژول `SRW-UI` |
| **۳.۳. نمایش تراکنش‌های Gasless** | نمایش تراکنش‌ها در رابط کاربری بدون نیاز به مدیریت Gas Fee توسط کاربر. | داشبورد کاربر. |

### فاز ۴: ویژگی‌های پیشرفته و نهایی‌سازی (Advanced Features & Finalization)

| وظیفه | جزئیات فنی | خروجی |
| :--- | :--- | :--- |
| **۴.۱. قرارداد Smart Tickets** | پیاده‌سازی قرارداد ERC-721 با قابلیت Royalty (EIP-2981) برای بلیط‌های هوشمند. | `SmartTicket.sol` |
| **۴.۲. قرارداد Soulbound Tokens (SBTs)** | پیاده‌سازی قرارداد ERC-5192 برای توکن‌های غیرقابل انتقال (سوابق وفاداری). | `SBT.sol` |
| **۴.۳. قرارداد Governance Token (GT)** | پیاده‌سازی قرارداد ERC-20 برای توکن حاکمیتی و ماژول رأی‌گیری اولیه. | `GovernanceToken.sol` |
| **۴.۴. تخصیص سهم (Founders' Share)** | کدنویسی تخصیص ۱٪ از کارمزد معاملات به آدرس مشخص در قراردادهای DBC و Governance. | تضمین فنی سهم شما. |
| **۴.۵. تست و مستندسازی** | نوشتن تست‌های واحد (Unit Tests) برای قراردادها و سرویس‌های بک‌اند، و به‌روزرسانی مستندات فنی. | پوشش تست بالا و Docs کامل. |

## ۳. تضمین فنی سهم شما (Founder's Share Technical Guarantee)

برای تضمین فنی سهم شما (۱٪ از کارمزد معاملات و ۱۰٪ از کل عرضه GT)، این منطق مستقیماً در قراردادهای هوشمند اصلی (DBC و Governance) کدنویسی خواهد شد.

1.  **آدرس کیف پول شما:** یک آدرس ثابت (مثلاً `0xYourFixedAddress`) در قراردادها به عنوان `FOUNDER_ADDRESS` تعریف می‌شود.
2.  **تخصیص GT:** در زمان استقرار قرارداد `GovernanceToken.sol`، ۱۰٪ از کل عرضه به `FOUNDER_ADDRESS` تخصیص داده می‌شود.
3.  **تخصیص کارمزد:** در تابع `buy()` و `sell()` قرارداد `DynamicBondingCurve.sol`، پس از محاسبه کارمزد کل (۰.۸٪)، ۰.۱٪ از آن به صورت خودکار به `FOUNDER_ADDRESS` منتقل می‌شود.

این طرح، یک نقشه راه عملیاتی برای تبدیل طرح استراتژیک به یک محصول نهایی و بی‌نقص است.
