# تحلیل جامع پروژه Tambr (RialToken)

این تحلیل جامع بر اساس بررسی ساختار، کد، و مستندات موجود در مخزن GitHub پروژه Tambr (RialToken) انجام شده است. هدف از این گزارش، ارائه یک دید کلی از وضعیت فعلی پروژه، شناسایی نواقص و نیازهای حیاتی، و ارائه توصیه‌های عملی برای توسعه‌دهنده جهت تکمیل و اجرای موفق پروژه است.

## ۱. خلاصه وضعیت پروژه

پروژه Tambr یک اکوسیستم مالی غیرمتمرکز (DeFi) با تمرکز بر توکنیزه کردن دارایی‌های کاربردی با پشتوانه ریال است. ساختار پروژه به صورت یک **Monorepo** با استفاده از `pnpm` پیاده‌سازی شده و شامل چهار بخش اصلی است: قراردادهای هوشمند، بک‌اند، ریلایر (Relayer) و فرانت‌اند.

| بخش | فناوری اصلی | وضعیت فعلی |
| :--- | :--- | :--- |
| **Contracts** | Solidity, Hardhat | ساختار اولیه قراردادها (Stablecoin, DBC, Smart Tickets, SBTs) ایجاد شده اما منطق ریاضی اصلی DBC ناقص است. |
| **Backend** | NestJS, TypeScript | ساختار ماژولار (KYC, Oracle, Wallet, Ticket) ایجاد شده. سرویس KYC با منطق اعتبارسنجی ایرانی (شماره موبایل و کد ملی) به صورت Mock پیاده‌سازی شده است. |
| **Relayer** | NestJS, TypeScript | ساختار اولیه برای سرویس Gasless Transaction (Meta-Transactions) ایجاد شده، اما منطق اصلی ارسال تراکنش‌ها ناقص است و تست‌های موجود بسیار ابتدایی هستند. |
| **Frontend** | Next.js, TypeScript | ساختار Next.js و Web3 (Wagmi/RainbowKit) تنظیم شده و صفحات اصلی (داشبورد، خرید/فروش توکن، ایجاد رویداد) به صورت اولیه پیاده‌سازی شده‌اند. |

## ۲. نواقص و کمبودهای حیاتی (Deficiencies)

این بخش شامل مهم‌ترین مواردی است که برای رسیدن به یک محصول قابل استفاده و امن باید تکمیل شوند.

### الف) قراردادهای هوشمند (Smart Contracts)

| نقص | جزئیات و اهمیت |
| :--- | :--- |
| **منطق اصلی DBC ناقص است** | فایل `TambrDynamicBondingCurve.sol` به صراحت اعلام می‌کند که منطق ریاضی اصلی برای منحنی پیوند پویا (DBC) صرفاً یک مثال ساده است. **این مهم‌ترین نقص پروژه است.** DBC قلب اقتصادی پروژه است و باید فوراً با فرمول دقیق و تست‌شده جایگزین شود. |
| **عدم وجود تست‌های جامع** | هیچ پوشه `test` یا فایل تستی در بخش قراردادها مشاهده نشد. قراردادهای مالی بدون تست‌های واحد (Unit Tests) و تست‌های یکپارچه‌سازی (Integration Tests) قابل استقرار در شبکه اصلی نیستند. |
| **عدم پیاده‌سازی توابع حیاتی** | توابع `mint` و `burn` در قرارداد DBC کامنت شده‌اند. این توابع برای عملکرد صحیح DBC و مدیریت عرضه Stablecoin ضروری هستند و باید در قرارداد `IRRStablecoin` پیاده‌سازی و در DBC فراخوانی شوند. |
| **عدم استفاده از Forwarder** | قرارداد DBC یک پارامتر `_trustedForwarder` در سازنده (Constructor) خود دارد، اما از آن در توابع `buy` و `sell` برای پیاده‌سازی Meta-Transaction استفاده نشده است. |

### ب) بک‌اند و ریلایر (Backend & Relayer)

| نقص | جزئیات و اهمیت |
| :--- | :--- |
| **سرویس KYC به صورت Mock است** | منطق اعتبارسنجی کد ملی و شماره موبایل ایرانی در `kyc.service.ts` به صورت محلی پیاده‌سازی شده است. برای یک پلتفرم مالی، این منطق باید به یک **سرویس احراز هویت ملی معتبر (مانند ساد۲۴ یا مشابه)** متصل شود. |
| **منطق ریلایر ناقص است** | سرویس `Relayer` (برای تراکنش‌های بدون گس) تنها یک ساختار اولیه است و منطق اصلی امضا و ارسال تراکنش‌های متا (Meta-Transaction) در آن پیاده‌سازی نشده است. |
| **عدم وجود تست‌های کافی در بک‌اند** | تست‌های موجود در `relayer.service.test.ts` و `oracle.service.test.ts` بسیار ابتدایی هستند (فقط بررسی می‌کنند که سرویس تعریف شده باشد) و پوشش دهی مناسبی ندارند. |
| **وابستگی به Git برای ذخیره‌سازی داده** | استفاده از Git برای ذخیره‌سازی داده‌های حیاتی (کاربران، تراکنش‌ها) در پوشه `/data` برای یک سیستم تولیدی (Production) مقیاس‌پذیر و امن نیست. این روش فقط برای MVP یا توسعه اولیه مناسب است. |

### ج) فرانت‌اند (Frontend)

| نقص | جزئیات و اهمیت |
| :--- | :--- |
| **عدم اتصال به منطق قراردادها** | فرانت‌اند به صورت ظاهری طراحی شده و هنوز به طور کامل به منطق قراردادهای هوشمند (مانند فراخوانی توابع `buy` و `sell` از DBC) متصل نشده است. |
| **نیاز به پیاده‌سازی UI/UX کامل** | صفحات موجود (مانند `create-event` و `tickets`) نیاز به تکمیل رابط کاربری و تجربه کاربری (UI/UX) برای تعاملات پیچیده بلاکچین دارند. |

## ۳. نیازهای حیاتی و توصیه‌های توسعه (Needs & Recommendations)

برای حرکت به سمت یک محصول قابل استقرار و امن، مسیر توسعه باید بر روی موارد زیر متمرکز شود.

### الف) اولویت‌های فوری (Immediate Priorities)

1.  **تکمیل منطق DBC:**
    *   **نیاز:** پیاده‌سازی دقیق فرمول ریاضی منحنی پیوند پویا در `TambrDynamicBondingCurve.sol`.
    *   **توصیه:** قبل از کدنویسی، فرمول را در یک محیط شبیه‌سازی (مانند Python یا Excel) مدل‌سازی کنید تا رفتار اقتصادی آن کاملاً درک و تأیید شود.

2.  **پیاده‌سازی تست‌های جامع قرارداد:**
    *   **نیاز:** ایجاد پوشه `test` در `packages/contracts` و نوشتن تست‌های واحد برای تمام توابع عمومی (Public) و حیاتی قراردادها (DBC, Stablecoin, SmartTicket).
    *   **توصیه:** از ابزارهایی مانند Hardhat/Foundry برای تست‌نویسی استفاده کنید و پوشش کد (Code Coverage) را به بالای ۹۰٪ برسانید.

3.  **اتصال KYC به سرویس خارجی:**
    *   **نیاز:** جایگزینی منطق Mock KYC با یک سرویس احراز هویت ملی ایرانی معتبر (مانند ساد۲۴ یا مشابه) برای تأیید هویت کاربران.
    *   **توصیه:** از ماژول `Oracle` در بک‌اند برای مدیریت ارتباط با این سرویس‌های خارجی استفاده کنید.

### ب) مسیر توسعه میان‌مدت (Mid-Term Development Path)

1.  **تکمیل سرویس ریلایر (Meta-Transactions):**
    *   **نیاز:** پیاده‌سازی منطق امضا و ارسال تراکنش‌های بدون گس در `packages/relayer` با استفاده از استاندارد EIP-712 و `TambrForwarder.sol`.
    *   **توصیه:** از کتابخانه‌هایی مانند Ethers.js یا Viem برای مدیریت امضاها و ارسال تراکنش‌ها استفاده کنید.

2.  **انتقال ذخیره‌سازی داده:**
    *   **نیاز:** جایگزینی سیستم ذخیره‌سازی مبتنی بر Git در پوشه `/data` با یک پایگاه داده رابطه‌ای (مانند PostgreSQL با TypeORM) یا NoSQL (مانند MongoDB).
    *   **توصیه:** با توجه به استفاده از TypeORM در بک‌اند، PostgreSQL گزینه مناسبی است.

3.  **تکمیل یکپارچه‌سازی فرانت‌اند:**
    *   **نیاز:** اتصال کامل فرانت‌اند به قراردادهای هوشمند (از طریق ریلایر) و سرویس‌های بک‌اند (KYC, Wallet, Ticket).
    *   **توصیه:** از hooksهای Wagmi و TanStack Query برای مدیریت وضعیت بلاکچین و کش کردن داده‌ها استفاده کنید.

### ج) ملاحظات امنیتی و عملیاتی (Security & Operations)

1.  **ممیزی امنیتی (Security Audit):**
    *   **نیاز:** پس از تکمیل منطق DBC و تست‌های جامع، قراردادهای هوشمند باید توسط یک شرکت ممیزی امنیتی معتبر بررسی شوند.
    *   **توصیه:** این مرحله قبل از استقرار در شبکه اصلی (Mainnet) ضروری است.

2.  **استقرار و CI/CD:**
    *   **نیاز:** پیاده‌سازی Dockerfiles برای تمام سرویس‌ها (Backend, Relayer) و تنظیم خطوط لوله CI/CD (مانند GitHub Actions) برای استقرار خودکار و تست مداوم.
    *   **توصیه:** این امر فرآیند توسعه و استقرار را حرفه‌ای و قابل اعتماد می‌کند.

3.  **مستندات فنی:**
    *   **نیاز:** مستندسازی کامل APIهای بک‌اند (با استفاده از Swagger/OpenAPI) و مستندات فنی قراردادهای هوشمند (با استفاده از NatSpec).
    *   **توصیه:** مستندات خوب، همکاری تیمی و نگهداری پروژه را در آینده تسهیل می‌کند.

## ۴. لیست قابل کپی برای توسعه‌دهنده

در زیر یک لیست چک‌لیست عملیاتی و قابل کپی برای توسعه‌دهنده ارائه شده است که مسیر پیش رو را مشخص می‌کند:

```markdown
# چک‌لیست توسعه Tambr (RialToken)

## فاز ۱: قراردادهای هوشمند (بحرانی)
- [ ] **تکمیل منطق ریاضی DBC:** پیاده‌سازی فرمول نهایی و دقیق منحنی پیوند در `TambrDynamicBondingCurve.sol`.
- [ ] **پیاده‌سازی توابع Mint/Burn:** افزودن توابع `mint` و `burn` در `IRRStablecoin.sol` و فراخوانی آن‌ها از DBC.
- [ ] **تست‌های جامع قرارداد:** ایجاد پوشه `test` و نوشتن تست‌های واحد برای DBC، Stablecoin، و SmartTicket. (پوشش کد > 90%)
- [ ] **یکپارچه‌سازی Forwarder:** استفاده از `_trustedForwarder` در توابع `buy` و `sell` برای پشتیبانی از Meta-Transactions.

## فاز ۲: بک‌اند و ریلایر (حیاتی)
- [ ] **اتصال KYC به سرویس ملی:** جایگزینی منطق Mock در `kyc.service.ts` با فراخوانی API یک سرویس احراز هویت ایرانی معتبر.
- [ ] **تکمیل منطق ریلایر:** پیاده‌سازی کامل منطق امضا و ارسال تراکنش‌های بدون گس در `packages/relayer`.
- [ ] **انتقال ذخیره‌سازی داده:** مهاجرت داده‌های `/data` به پایگاه داده PostgreSQL (یا MongoDB) و تنظیم TypeORM برای ماژول‌های Backend.
- [ ] **تست‌های یکپارچه‌سازی بک‌اند:** نوشتن تست‌های یکپارچه‌سازی برای ماژول‌های KYC، Wallet و Oracle.

## فاز ۳: فرانت‌اند و یکپارچه‌سازی (تکمیل)
- [ ] **اتصال کامل فرانت‌اند:** اتصال صفحات `buy-tokens` و `sell-tokens` به توابع DBC از طریق سرویس Relayer.
- [ ] **تکمیل UI/UX:** بهبود رابط کاربری و تجربه کاربری برای تعاملات بلاکچین (مانند نمایش وضعیت تراکنش، مدیریت خطاها).
- [ ] **پیاده‌سازی Social Recovery Wallet UI:** تکمیل رابط کاربری برای ایجاد و بازیابی کیف پول با استفاده از منطق Social Recovery.

## فاز ۴: عملیات و امنیت (نهایی)
- [ ] **ممیزی امنیتی قراردادها:** ارسال قراردادهای هوشمند برای ممیزی توسط یک شرکت معتبر.
- [ ] **CI/CD و Dockerization:** ایجاد Dockerfiles و تنظیم خطوط لوله CI/CD برای استقرار خودکار.
- [ ] **مستندسازی فنی:** مستندسازی APIهای بک‌اند (Swagger) و قراردادهای هوشمند (NatSpec).
```
